# GPT-2 Implementation from Scratch

–ü—Ä–æ—Å—Ç–∞—è –∏ —á–∏—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã GPT-2 –Ω–∞ PyTorch —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ –∏ –∑–∞–≥—Ä—É–∑–∫–æ–π –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã—Ö –≤–µ—Å–æ–≤.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ –ß–∏—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã GPT-2 –Ω–∞ PyTorch
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã—Ö –≤–µ—Å–æ–≤ –æ—Ç Hugging Face (gpt2, gpt2-medium, gpt2-large, gpt2-xl)
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (temperature, top-k)
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è –∏ —Ö–æ—Ä–æ—à–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CPU –∏ GPU (CUDA)
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
gpt2-project/
‚îú‚îÄ‚îÄ src/                    # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ model/             # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–¥–µ–ª–∏ GPT-2
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modules.py     # –ë–∞–∑–æ–≤—ã–µ –º–æ–¥—É–ª–∏ (Attention, MLP, Block)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ gpt_model.py   # –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å GPT
‚îÇ   ‚îú‚îÄ‚îÄ data/              # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dataset.py     # Dataset –∫–ª–∞—Å—Å
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ datamodule.py  # DataModule –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ inference/         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ generator.py   # –ö–ª–∞—Å—Å –¥–ª—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ scripts/               # –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ inference.py       # –°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ train.py          # –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è (–∑–∞–≥–æ—Ç–æ–≤–∫–∞)
‚îú‚îÄ‚îÄ weights/               # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –≤–µ—Å–æ–≤ –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ README.md             # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <repository-url>
cd gpt2-project
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- torch == 2.8.0
- transformers == 4.55.4
- numpy
- tqdm
- scikit-learn

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ —Å –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é

```bash
python scripts/inference.py \
    --prompt "The future of artificial intelligence" \
    --model_type gpt2 \
    --max_tokens 50 \
    --temperature 0.8 \
    --top_k 50
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ

```python
import torch
from transformers import GPT2Tokenizer
from src.model.gpt_model import load_model
from src.inference.generator import GPT2Inference

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (CUDA/CPU)
device = torch.device("cuda" if torch.cuda.is_available() else "cpu")

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä–∞ –∏ –º–æ–¥–µ–ª–∏
tokenizer = GPT2Tokenizer.from_pretrained("openai-community/gpt2")
model = load_model("", "gpt2")  # –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ = –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Hugging Face

# –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–µ—Ä–∞
inferencer = GPT2Inference(model, tokenizer, device)

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
result = inferencer.generate_sequence(
    prompt="The future of AI is",
    max_new_tokens=100,
    temperature=0.7,
    top_k=50
)

print("–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:")
print(result)
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–∫—Ä–∏–ø—Ç inference.py

```bash
python scripts/inference.py \
    --prompt "–í–∞—à —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å" \
    --model_type [gpt2|gpt2-medium|gpt2-large|gpt2-xl] \
    --model_path "–ø—É—Ç—å/–∫/–≤–µ—Å–∞–º" \
    --max_tokens 100 \
    --temperature 0.8 \
    --top_k 50
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `--prompt`: –ù–∞—á–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)
- `--model_type`: –¢–∏–ø –º–æ–¥–µ–ª–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: gpt2)
- `--model_path`: –ü—É—Ç—å –∫ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –≤–µ—Å–∞–º –º–æ–¥–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `--max_tokens`: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `--temperature`: –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å—é (0.1-2.0)
- `--top_k`: Top-k sampling –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ —Ç–æ–∫–µ–Ω–æ–≤

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–æ–¥–µ–ª–∏

- `gpt2` - 124M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `gpt2-medium` - 350M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤  
- `gpt2-large` - 774M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `gpt2-xl` - 1558M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É GPT-2:

- **Self-Attention**: –ú–Ω–æ–≥–æ–≥–æ–ª–æ–≤–æ–µ —Å–∞–º–æ–≤–Ω–∏–º–∞–Ω–∏–µ —Å –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **MLP**: –î–≤—É—Ö—Å–ª–æ–π–Ω–∞—è —Å–µ—Ç—å —Å –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π GELU
- **Transformer Blocks**: –ö–æ–º–±–∏–Ω–∞—Ü–∏—è attention –∏ MLP —Å residual connections
- **Positional Embeddings**: –£—á–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
- **Layer Normalization**: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –±–ª–æ–∫–æ–º

## üíæ –ó–∞–≥—Ä—É–∑–∫–∞ –≤–µ—Å–æ–≤

–ú–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ—Å–∞ –∏–∑ Hugging Face:

```python
# –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
model = load_model("", "gpt2-medium")

# –ò–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–µ—Å–æ–≤
model = load_model("path/to/checkpoint.pth", "gpt2")
```

## –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- OpenAI –∑–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É GPT-2
- Hugging Face –∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã—Ö –≤–µ—Å–æ–≤
- –°–æ–æ–±—â–µ—Å—Ç–≤–æ PyTorch –∑–∞ –æ—Ç–ª–∏—á–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã GPT-2. –î–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ç Hugging Face –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤.